!function(e,n,t,o){var i=Date.now(),a=[],r=0,s=Date.now(),c=[],d=!1,u=null;function l(){var e=sessionStorage.getItem("analytics_session");return e||(e="sess_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),sessionStorage.setItem("analytics_session",e)),e}function m(e,n){if(navigator.sendBeacon)try{var t=new Blob([JSON.stringify(n)],{type:"application/json"});if(navigator.sendBeacon(e,t))return Promise.resolve(!0)}catch(e){console.log("SendBeacon failed, trying fetch:",e)}return fetch(e,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(){return!0}).catch(function(e){return console.error("Request failed:",e),!1})}function g(n,o){var a,r={tracking_id:e,session_id:l(),event_type:n,path:window.location.pathname,referrer:document.referrer||null,user_agent:navigator.userAgent,screen_width:screen.width,screen_height:screen.height,viewport_width:window.innerWidth,viewport_height:window.innerHeight,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,duration:"pageview"===n?Date.now()-i:null},s={utm_source:(a=new URLSearchParams(window.location.search)).get("utm_source"),utm_medium:a.get("utm_medium"),utm_campaign:a.get("utm_campaign")};r.utm_source=s.utm_source,r.utm_medium=s.utm_medium,r.utm_campaign=s.utm_campaign,o&&(r.event_name=o.name,r.event_data=o.data),console.log("Tracking event:",n,r),m(t,r).then(function(e){e?console.log("Track success: sent via sendBeacon/fetch"):console.error("Analytics error: request failed")})}function w(e,n){a.push({type:e,data:n,path:window.location.pathname,timestamp:Date.now()}),console.log("Behavior event added:",e,"Buffer size:",a.length)}function h(){if(0!==a.length){var e={projectId:n,sessionId:l(),events:a.slice()};console.log("Sending behavior events:",a.length),m(o,e).then(function(e){e?(console.log("Behavior tracking success: sent via sendBeacon/fetch"),a=[]):console.error("Behavior tracking error: request failed")})}}function v(){var e=Math.round(window.scrollY/(document.body.scrollHeight-window.innerHeight)*100);e>r&&e%25==0&&(w("scroll",{depth:e,position:window.scrollY}),r=e)}function _(e){var n=e.target,t={x:e.clientX,y:e.clientY,tag:n.tagName.toLowerCase(),id:n.id||null,className:n.className||null,text:n.textContent?n.textContent.substring(0,100):null,href:n.href||null},o=Date.now(),i=c.filter(function(e){return o-e<1e3});i.push(o),c=i,i.length>=3?w("rage_click",t):w("click",t)}function p(e){var n=e.target;"INPUT"!==n.tagName&&"TEXTAREA"!==n.tagName&&"SELECT"!==n.tagName||w("form_interaction",{type:e.type,field:n.name||n.id||"unnamed",tag:n.tagName.toLowerCase()})}function f(){s=Date.now(),d&&(d=!1,w("idle_end",{duration:Date.now()-s})),clearTimeout(u),u=setTimeout(function(){d=!0,w("idle_start",{timestamp:Date.now()})},3e4)}function y(){document.hidden?w("page_hidden",{timestamp:Date.now()}):w("page_visible",{timestamp:Date.now()})}console.log("Analytics tracker initialized with:",{trackingId:e,projectId:n,apiUrl:t,behaviorUrl:o}),g("pageview"),window.addEventListener("scroll",v,{passive:!0}),document.addEventListener("click",_,{passive:!0}),document.addEventListener("input",p,{passive:!0}),document.addEventListener("change",p,{passive:!0}),document.addEventListener("focus",p,{passive:!0}),document.addEventListener("blur",p,{passive:!0}),["mousedown","mousemove","keypress","scroll","touchstart"].forEach(function(e){document.addEventListener(e,f,{passive:!0})}),document.addEventListener("visibilitychange",y,{passive:!0}),window.addEventListener("beforeunload",function(){w("navigation",{from:document.referrer,to:window.location.href,timestamp:Date.now()}),h()}),setInterval(h,1e4),window.addEventListener("pagehide",h)}(window.__TRACKING_ID__,window.__PROJECT_ID__,window.__API_URL__,window.__BEHAVIOR_URL__);
