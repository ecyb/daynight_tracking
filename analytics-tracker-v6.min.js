!function(e,n,t,a){var o=Date.now(),i=[],r=0,s=Date.now(),c=[],d=!1,l=null;function u(){var e=sessionStorage.getItem("analytics_session");return e||(e="sess_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),sessionStorage.setItem("analytics_session",e)),e}function m(e,n){try{var t=new Blob([JSON.stringify(n)],{type:"application/json"});return navigator.sendBeacon(e,t)}catch(e){return console.error("SendBeacon error:",e),!1}}function g(n,a){var i,r={tracking_id:e,session_id:u(),event_type:n,path:window.location.pathname,referrer:document.referrer||null,user_agent:navigator.userAgent,screen_width:screen.width,screen_height:screen.height,viewport_width:window.innerWidth,viewport_height:window.innerHeight,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,duration:"pageview"===n?Date.now()-o:null},s={utm_source:(i=new URLSearchParams(window.location.search)).get("utm_source"),utm_medium:i.get("utm_medium"),utm_campaign:i.get("utm_campaign")};r.utm_source=s.utm_source,r.utm_medium=s.utm_medium,r.utm_campaign=s.utm_campaign,a&&(r.event_name=a.name,r.event_data=a.data),console.log("Tracking event:",n,r),m(t,r)?console.log("Track success: sent via sendBeacon"):console.error("Analytics error: sendBeacon failed")}function w(e,n){i.push({type:e,data:n,path:window.location.pathname,timestamp:Date.now()}),console.log("Behavior event added:",e,"Buffer size:",i.length)}function v(){if(0!==i.length){var e={projectId:n,sessionId:u(),events:i.slice()};console.log("Sending behavior events:",i.length),m(a,e)?(console.log("Behavior tracking success: sent via sendBeacon"),i=[]):console.error("Behavior tracking error: sendBeacon failed")}}function _(){var e=Math.round(window.scrollY/(document.body.scrollHeight-window.innerHeight)*100);e>r&&e%25==0&&(w("scroll",{depth:e,position:window.scrollY}),r=e)}function h(e){var n=e.target,t={x:e.clientX,y:e.clientY,tag:n.tagName.toLowerCase(),id:n.id||null,className:n.className||null,text:n.textContent?n.textContent.substring(0,100):null,href:n.href||null},a=Date.now(),o=c.filter(function(e){return a-e<1e3});o.push(a),c=o,o.length>=3?w("rage_click",t):w("click",t)}function p(e){var n=e.target;"INPUT"!==n.tagName&&"TEXTAREA"!==n.tagName&&"SELECT"!==n.tagName||w("form_interaction",{type:e.type,field:n.name||n.id||"unnamed",tag:n.tagName.toLowerCase()})}function f(){s=Date.now(),d&&(d=!1,w("idle_end",{duration:Date.now()-s})),clearTimeout(l),l=setTimeout(function(){d=!0,w("idle_start",{timestamp:Date.now()})},3e4)}function E(){document.hidden?w("page_hidden",{timestamp:Date.now()}):w("page_visible",{timestamp:Date.now()})}console.log("Analytics tracker initialized with:",{trackingId:e,projectId:n,apiUrl:t,behaviorUrl:a}),g("pageview"),window.addEventListener("scroll",_,{passive:!0}),document.addEventListener("click",h,{passive:!0}),document.addEventListener("input",p,{passive:!0}),document.addEventListener("change",p,{passive:!0}),document.addEventListener("focus",p,{passive:!0}),document.addEventListener("blur",p,{passive:!0}),["mousedown","mousemove","keypress","scroll","touchstart"].forEach(function(e){document.addEventListener(e,f,{passive:!0})}),document.addEventListener("visibilitychange",E,{passive:!0}),window.addEventListener("beforeunload",function(){w("navigation",{from:document.referrer,to:window.location.href,timestamp:Date.now()}),v()}),setInterval(v,1e4),window.addEventListener("pagehide",v)}(window.__TRACKING_ID__,window.__PROJECT_ID__,window.__API_URL__,window.__BEHAVIOR_URL__);
