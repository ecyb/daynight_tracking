!function(o,n,i,t){var e,a=Date.now(),r=[],s=0,c=Date.now(),d=[],u=!1,l=null;function g(){var e=sessionStorage.getItem("analytics_session");return e||(e="sess_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),sessionStorage.setItem("analytics_session",e)),e}function m(e,n){var t={utm_source:(t=new URLSearchParams(window.location.search)).get("utm_source"),utm_medium:t.get("utm_medium"),utm_campaign:t.get("utm_campaign")},t={tracking_id:o,session_id:g(),event_type:e,path:window.location.pathname+window.location.search,referrer:document.referrer||null,user_agent:navigator.userAgent,screen_width:window.screen.width,screen_height:window.screen.height,viewport_width:window.innerWidth,viewport_height:window.innerHeight,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,duration:"pageview_end"===e?Date.now()-a:null};Object.assign(t,n),console.log("Tracking event:",e,t),fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(e){return console.log("Track response:",e.status),e.json()}).then(function(e){console.log("Track success:",e)}).catch(function(e){console.error("Analytics error:",e)})}function w(e){0!==e.length&&(console.log("Sending behavior events:",e.length),fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:n,sessionId:g(),events:e})}).then(function(e){return console.log("Behavior response:",e.status),e.json()}).then(function(e){console.log("Behavior success:",e)}).catch(function(e){console.error("Behavior tracking error:",e)}))}function h(e,n){r.push({type:e,data:n,path:window.location.pathname,timestamp:Date.now()}),console.log("Behavior event added:",e,"Buffer size:",r.length),10<=r.length&&(w(r.slice()),r=[])}function _(){c=Date.now(),u&&(h("idle",{ended:!0,duration:Date.now()-c}),u=!1),l&&clearTimeout(l),l=setTimeout(function(){h("idle",{started:u=!0,duration:3e4})},3e4)}window.addEventListener("scroll",function(){_();var e=window.pageYOffset||document.documentElement.scrollTop,n=document.documentElement.scrollHeight-window.innerHeight,n=0<n?Math.round(e/n*100):0;5<=Math.abs(n-s)&&(h("scroll",{depth:n,position:e}),s=n)},{passive:!0}),window.addEventListener("click",function(e){_();var n=Date.now();d.push(n),d=d.filter(function(e){return n-e<1e3});e={x:e.clientX,y:e.clientY,element:e.target.tagName,text:(e.target.textContent||"").substring(0,50)};3<=d.length?(h("rage_click",Object.assign({},e,{count:d.length})),d=[]):h("click",e)}),window.addEventListener("focusin",function(e){var n;"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&"SELECT"!==e.target.tagName||(n=e.target.closest("form"),h("form",{action:"start",field:e.target.name||e.target.id,formId:n?n.id:"unknown"}))}),document.addEventListener("submit",function(e){h("form",{action:"complete",formId:e.target.id||"unknown"})}),document.addEventListener("keypress",_),document.addEventListener("mousemove",function(){clearTimeout(e),e=setTimeout(_,200)}),document.addEventListener("visibilitychange",function(){document.hidden?(h("navigation",{action:"hidden"}),w(r.slice()),r=[]):h("navigation",{action:"visible"})}),setInterval(function(){0<r.length&&(w(r.slice()),r=[])},1e4),window.addEventListener("beforeunload",function(){m("pageview_end"),0<r.length&&w(r.slice())}),console.log("Analytics tracker initialized with:",{trackingId:o,projectId:n,apiUrl:i,behaviorUrl:t}),m("pageview"),_(),window.trackEvent=function(e,n){m("event",{event_name:e,event_data:n})}}(window.__TRACKING_ID__,window.__PROJECT_ID__,window.__API_URL__,window.__BEHAVIOR_URL__);
